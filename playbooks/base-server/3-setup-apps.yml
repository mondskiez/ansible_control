---
    
    - name: Installing base apps
      apt:
        update_cache: yes
        cache_valid_time: 3600
        name:
          - haveged
          - htop 
          - git
          - aptitude
          - net-tools
          - zsh
          - zsh-syntax-highlighting
          - powerline
          - fonts-powerline 
        state: latest
        autoclean: yes
        autoremove: yes
        purge: yes

    - name: Check what is using Port 53
      shell:
        cmd: "sudo lsof -i:53 | awk 'FNR==2 {print $1}'"
      register: port53user
    
    - name: What is using Port 53
      debug:
        msg: Port 53 is being used by "{{ port53user.stdout }}"

    - name: "editing /etc/systemd/resolved.conf"
      lineinfile:
        path: /etc/systemd/resolved.conf
        regexp: "{{ item.regexp }}"
        line: "{{ item.line }}"
      loop:
        - regexp: '^#DNS='
          line: 'DNS=1.1.1.1'
        - regexp: '^#DNSStubListener=yes'
          line: 'DNSStubListener=no'
      when: port53user.stdout == port53systemd
    
    - name: "force removal of symbolic link of resolv.conf"
      command: sudo ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf
      when: port53user.stdout == port53systemd

    - name: change morty default shell to ZSH
      command: usermod -s /usr/bin/zsh morty

    - name: "OMZ establish home directory."
      set_fact:
        omz_user_home_dir: "/home/morty"
    
    - name: "OMZ establish install location."
      set_fact:
        omz_install_path: "/home/morty/.oh-my-zsh"
    
    - name: check if .oh-my-zsh folder exists
      stat:
        path: "/home/morty/.oh-my-zsh"
      register: omz_folder_present

    - name: omz folder exists
      debug:
        msg: ".oh-my-zsh folder exists"
      when: omz_folder_present.isdir is defined and omz_folder_present.stat.isdir

    - name: "OMZ clone Robby Russell OhMyZSH git repo for morty."
      git:
        repo: "https://github.com/robbyrussell/oh-my-zsh.git"
        dest: "/home/morty/.oh-my-zsh"
        update: "true"
        accept_hostkey: "true"
        version: "master"
      when: omz_folder_present.isdir is false
    
    - name: check if zsh-autosuggestion folder exists
      stat:
        path: "/home/morty/.oh-my-zsh/custom/plugins/zsh-autosuggestions"
      register: zsh_auto_present

    - name: "zsh-autosuggestions folder exists"
      debug:
        msg: "zsh-autosuggestions folder exists"
      when: zsh_auto_present.isdir is defined and zsh_auto_present.stat.isdir

    - name: "OMZ clone ZSH Auto Suggestions git repo"
      git:
        repo: "https://github.com/zsh-users/zsh-autosuggestions"
        dest: "/home/morty/.oh-my-zsh/custom/plugins/zsh-autosuggestions"
        update: "true"
        accept_hostkey: "true"
        version: "master"
      when: zsh_auto_present.isdir is false
    
    - name: "OMZ | set ownership on newly cloned repository."
      file:
        path: "/home/morty/.oh-my-zsh"
        owner: morty
        group: morty
        recurse: "true"
    
    - name: create .hushlogin file to disable MOTD
      command: touch ~/.hushlogin

    - name: "Creating a .zshrc file"
      copy:
        dest: /home/morty/.zshrc
        content: |
          ZSH_THEME="xiong-chiamiov-plus"
          plugins=(git sudo colored-man-pages zsh-autosuggestions)
          source /home/morty/.oh-my-zsh/oh-my-zsh.sh
          source /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
          export PATH="/home/morty/.local/bin:$PATH"%
          alias tq="clear && /usr/bin/bash /home/morty/tq.sh"
          alias tp="clear && /usr/bin/bash /home/morty/tp.sh"
          alias update="clear && sudo apt-get update -y && sudo apt-get upgrade -y && sudo apt-get dist-upgrade -y && sudo apt autoclean -y && sudo apt autoremove -y"
          alias f2bss="sudo docker exec -it fail2ban fail2ban-client status sshd"
          alias f2br="sudo docker exec -it fail2ban fail2ban-client restart"
        owner: "morty"
        group: "morty"
    
    - name: Run source to .zshrc to effect changes
      shell: "/usr/bin/zsh /home/morty/.zshrc"